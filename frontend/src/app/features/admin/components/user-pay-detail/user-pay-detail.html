<!-- Búsqueda -->
<div class="flex justify-end mb-4">
    <div class="relative w-full sm:w-64">
        <svg xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-600 pointer-events-none">
            <path stroke-linecap="round" stroke-linejoin="round"
                    d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/>
        </svg>
        <input
            type="text"
            [(ngModel)]="busqueda"
            (input)="buscar()"
            placeholder="Buscar usuario..."
            class="w-full bg-[#C25FA8] to-[#2b103f] font-bold py-2 pl-10 pr-4 rounded-lg text-black"
        />

        <!-- LISTA DE RESULTADOS -->
        <ul *ngIf="resultadosBusqueda.length > 0"
            class="absolute w-full bg-white border rounded-lg mt-1 z-50 shadow-lg">

            <li *ngFor="let usuario of resultadosBusqueda"
                (click)="seleccionarUsuario(usuario)"
                class="px-4 py-2 cursor-pointer hover:bg-pink-200 text-gray-600">

                {{ usuario.clave_usuario }} - {{ usuario.nombres }} {{ usuario.apellidos }}
                <br>
                <small class="text-gray-600">
                    {{ usuario.telefono }} - {{ usuario.email }}
                </small>
            </li>
        </ul>
    </div>
</div>

<div class="container mx-auto max-w-4xl">
    <div class="grid lg:grid-cols-2 gap-12 items-center bg-black/10 shadow-purple-600 backdrop-blur-sm p-8 rounded-2xl shadow-xl">
        <div class="text-center">
            <h1 class="font-atomic text-pink-600 text-7xl mb-8">Registro Pago</h1>
            <div class="relative inline-block">
                <img 
                    [src]="user?.ruta_imagen ? user.ruta_imagen : 'https://placehold.co/200x200/4a0e4e/FFF?text=User'"
                    alt="Foto de perfil"
                    class="w-52 h-52 rounded-full object-cover border-4 border-gray-700">
            </div>
        </div>

        <div class="bg-white/10 p-8 rounded-2xl">
            <div *ngIf="user">
            <form class="space-y-4">
            <div class="grid md:grid-cols-2 gap-4">
                <!-- Campos informativos (solo lectura) -->
                <div>
                    <label class="text-black font-medium">Clave</label>
                    <input type="text" [(ngModel)]="user.clave_usuario" name="clave" readonly class="input-field bg-gray-200">
                </div>

                <div>
                    <label class="text-black font-medium">Status</label>
                    <input type="text" [(ngModel)]="user.status" name="status" readonly class="input-field bg-gray-200">
                </div>

                <div>
                    <label class="text-black font-medium">Nombre</label>
                    <input type="text" [(ngModel)]="user.nombres" name="nombres" readonly class="input-field bg-gray-200">
                </div>

                <div>
                    <label class="text-black font-medium">Apellidos</label>
                    <input type="text" [(ngModel)]="user.apellidos" name="apellidos" readonly class="input-field bg-gray-200">
                </div>

                <!-- Fechas provenientes de la tabla pagos (solo lectura) -->
                <div>
                    <label class="text-black font-medium">Fecha de Inscripción</label>
                    <input type="text"
                        [value]="pago.fecha_ingreso ? (pago.fecha_ingreso | date:'dd/MM/yyyy') : ''"
                        readonly class="input-field bg-gray-200">
                </div>

                <div>
                    <label class="text-black font-medium">Fecha de Corte (actual)</label>
                    <input type="text"
                        [value]="pago.fecha_corte ? (pago.fecha_corte | date:'dd/MM/yyyy') : ''"
                        readonly class="input-field bg-gray-200">
                </div>

                <!-- Campos que el usuario puede actualizar: monto_pagado -->
                <div>
                    <label class="text-black font-medium">Saldo a Pagar</label>
                    <input type="text"
                        [value]="pago.saldo_mostrar ?? 0 | number:'1.0-0'"
                        readonly class="input-field bg-gray-200">
                </div>

                <div>
                    <label class="text-black font-medium">Próximo Corte</label>
                    <input type="text"
                        [value]="pago.proximo_corte ? (pago.proximo_corte | date:'dd/MM/yyyy') : ''"
                        readonly class="input-field bg-gray-200">
                </div>

                <!-- ESTE campo sí puede editarse: monto_pagado (al guardar afecta a fecha_corte segun reglas) -->
                <div class="md:col-span-2">
                    <label class="text-black font-medium">Monto pagado</label>
                    <input type="number"
                        [(ngModel)]="pago.monto_pagado"
                        name="monto_pagado"
                        (ngModelChange)="onMontoPagadoChange($event)"
                        class="input-field">
                </div>

            </div>

            <button type="button" (click)="guardarCambios()" class="w-full mt-4 bg-pink-600 hover:bg-pink-700 font-bold py-3 rounded-lg">
                Guardar Cambios
            </button>
            </form>
            </div>
        </div>
    </div>
    <div *ngIf="mensaje" class="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow">
    {{ mensaje }}
    </div>

    <a routerLink="/admin/pago" class="fixed bottom-6 left-6 bg-gray-900 p-4 rounded-full hover:bg-black">
        <!-- icon -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
             viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12" />
            <polyline points="12 19 5 12 12 5" />
        </svg>
    </a>
</div>
