<div class="container mx-auto">
  <div class="flex justify-between items-center mb-6">

    <!-- Título y fecha -->
    <div>
      <h1 class="font-atomic text-pink-600 text-6xl sm:text-7xl">Pagos</h1>

      <p class="text-gray-900 mt-4 text-2xl">
        Hora: {{ fechaHoraActual() | date:'HH:mm:ss' }},
        Fecha: {{ fechaHoraActual() | date:'fullDate':'':'es' }}
      </p>
    </div>

    <!-- Filtros -->
    <div class="flex flex-col ml-5">
      <h3 class="font-atomic text-pink-600 text-2xl mb-2">Filtrar por:</h3>

      <div class="flex flex-wrap gap-2 sm:gap-4 items-center relative">

        <!-- Botones -->
        <button class="sub-nav-btn"
                [ngClass]="{'active-sub-nav': filtroTipoPago==='todos'}"
                (click)="filtroTipoPago='todos'; cargarPagos()">
        Todos
        </button>

        <button class="sub-nav-btn"
                [ngClass]="{'active-sub-nav': filtroTipoPago==='Mensual'}"
                (click)="filtroTipoPago='Mensual'; cargarPagos()">
        Pagos Mensuales 
        </button>

        <button class="sub-nav-btn"
                [ngClass]="{'active-sub-nav': filtroTipoPago==='Quincenal'}"
                (click)="filtroTipoPago='Quincenal'; cargarPagos()">
        Pagos Quincenales
        </button>


        <!-- Búsqueda -->
        <div class="relative w-full sm:w-64">
          <svg xmlns="http://www.w3.org/2000/svg"
               fill="none"
               viewBox="0 0 24 24"
               stroke-width="1.5"
               stroke="currentColor"
               class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-600 pointer-events-none">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/>
          </svg>

          <input
            type="text"
            [(ngModel)]="busqueda"
            placeholder="Buscar usuario..."
            class="w-full bg-[#C25FA8] to-[#2b103f] border-transparent font-bold py-2 pl-10 pr-4 rounded-lg text-white"
            />
        </div>

      </div>
    </div>
  </div>
</div>


<!-- TABLA -->
<div class="container mx-auto bg-black/10 shadow-purple-600 backdrop-blur-sm p-8 rounded-xl shadow-xl text-black">

  <div class="overflow-x-auto">
    <table class="w-full text-left text-sm whitespace-nowrap">
      <thead>
        <tr class="border-b border-white/20">
          <th class="p-3">Clave</th>
          <th class="p-3">Nombre Completo</th>
              <!-- Status con filtros dentro -->
            <th class="p-3 relative">

            <!-- Flecha que indica opciones -->
            <div class="flex items-center gap-2 cursor-pointer group">
                <span class="font-bold">Status</span>
                <!-- Flecha -->
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-600" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                </svg>

                <!-- Botones ocultos, aparecen al hover -->
                <div class="absolute top-full left-0 mt-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10">
                <button
                    class="sub-nav-btn text-xs"
                    [ngClass]="{ 'active-sub-nav': filtroStatus === '' }"
                    (click)="filtrar('')">Todos</button>

                <button
                    class="sub-nav-btn text-xs"
                    [ngClass]="{ 'active-sub-nav': filtroStatus === 'activo' }"
                    (click)="filtrar('activo')">Activos</button>

                <button
                    class="sub-nav-btn text-xs"
                    [ngClass]="{ 'active-sub-nav': filtroStatus === 'inactivo' }"
                    (click)="filtrar('inactivo')">Inactivos</button>

                <button
                    class="sub-nav-btn text-xs"
                    [ngClass]="{ 'active-sub-nav': filtroStatus === 'pendiente' }"
                    (click)="filtrar('pendiente')">Pendientes</button>
                </div>
            </div>

            </th>
          <th class="p-3 text-center">Acciones</th>
        </tr>
      </thead>

      <tbody>

        @for (user of usersFiltrados; track user.clave_usuario) {


        <tr class="border-b border-white/10 hover:bg-white/5">

          <!-- Clave -->
          <td class="p-3">{{ user.clave_usuario }}</td>

          <!-- Nombre -->
          <td class="p-3">
            <a [routerLink]="['/admin/pago', user.clave_usuario, 'detallepago']"
               class="hover:text-pink-400 hover:underline">
              {{ user.nombres }} {{ user.apellidos }}
            </a>
          </td>

          <!-- Status -->
          <td class="p-3">
            <span
            [ngClass]="
                user.status === 'activo'
                ? 'bg-green-500 text-white px-2 py-1 rounded-full text-sm shadow'
                : user.status === 'inactivo'
                    ? 'bg-red-500 text-white px-2 py-1 rounded-full text-sm shadow'
                    : 'bg-yellow-500 text-black px-2 py-1 rounded-full text-sm shadow'
            "
            >
            {{ user.status || 'pendiente' }}
            </span>

          </td>

          <!-- Acciones -->
          <td class="p-3">
            <div class="flex justify-center space-x-2">

                        <a  [routerLink]="['/admin/pago', user.clave_usuario, 'detallepago']" class="action-btn" title="Pagos">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                                <circle cx="12" cy="14" r="4"></circle>
                                <line x1="12" y1="12" x2="12" y2="16"></line>
                            </svg>
                        </a>


            </div>
          </td>
        </tr>

        }

      </tbody>
    </table>
  </div>
</div>


@if (selectedUserForQr()) {
  <app-qr-code-modal
    [user]="selectedUserForQr()"
    (close)="closeQrModal()"></app-qr-code-modal>
}
